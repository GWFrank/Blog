---
title: "計概期末專題 黑白棋Agent"
tags: [Coding, Python, Reversi]
---

##  TLDR

今年(109-1)計概單班的期末專題(其實應該只算是一次作業？)是做一個黑白棋Agent，我和隊友用minimax + 神經網路做的evaluation實做，最後在31組中拿下第一名，對所有其他組都有超過0.5的勝率。這篇文章將會稍微紀錄一下開發的過程和一些心得及想法。

## Initial Plan

在這次project之前我並沒有開發過類似的東西，所以完全是第一次的嘗試。一開始先隨便丟了幾個想法，然後找有沒有人做過類似的東西，找到了[棋類AI(以五子棋為例)](https://reurl.cc/d5j9yV)、[電腦黑白棋](https://reurl.cc/m9j7M1)、[A Genetic Algorithm to Improve an Othello Program](https://reurl.cc/9XYxvn)。這幾個都是用minimax當基底做的，到這裡我們也大概確定接下來會是做minimax，evaluation function先做最簡單的查表，再看看有什麼可以改良的。

## Basic Minimax

### 理論(?)

首先來簡單講一下minimax在做什麼。理想上，minimax會把整個遊戲樹都算好，接著從遊戲樹的底端往上，白方選擇會對白方最有利的位置下棋，黑棋則反之，一路推回去後就知道哪個位置是最佳的策略。但是因為計算時間有限，30秒內要把黑白棋全部都算完近乎不可能，我們必須要設定搜尋深度的上限。當搜尋到了上限的深度時，必須使用一個函數(evaluation function)為目前的盤面打分數來取代繼續往下搜尋。這個分數必須要能很好的反應出佔有優勢的一方，也就是(在我們的實做中)分數越高表示白棋越可能贏，分數越低表示黑棋越可能贏。

### 實做

實做的第一步是刻一個找出合法下棋位置的function，這裡沒有用什麼特別的演算法來做。有測試過使用`set`和`list`紀錄合法位置的速度，最後發現是`list`快一點點，但其實沒有顯著的影響。另外原本是用2d的`list`當作棋盤做搜尋，後面改用1d的可以加快一些(大約多搜一層)。

再來是實際刻Minimax。這部份其實是隊友刻的，照他所述他就是把wikipedia上面的psuedo code翻成python再修改一下而已。Evaluation function這時候是用在前面提到的論文內的一個表，將棋子以那張表加權後相加，計算盤面分數。

## Improvements

最初未經改良的Minimax要在時間限制內完成比賽大概只能搜尋3層而已。用python的`cProfile`工具，抓出搜尋合法位置的`getAvailableSpot()`佔用不少時間，稍加優化後能多搜尋一層。

另一個優化的點是使用Alpha-Beta剪枝，這個剪枝的核心思想是如果「目前這條分支的最佳可能情況」比前面已經得到的「其他分之的最佳情況」還糟的話，就不用繼續搜尋下去。這個優化又讓我們能夠多搜尋一層，搜尋5層時可以10秒完成一場比賽，搜尋6層時壓線在25秒內完成。

有一個做到一半最後沒有完成的優化是Zobrist hash+查表，因為棋盤有左右、上下、旋轉對稱，有些搜尋可能會重複，利用Zobrist hash建一個棋盤盤面對應走法的hash table。或是利用TA提供的4GB空間放，先行把搜尋深度更深的結果存好，實際運行時先在資料庫中搜尋，搜尋不到時再實際跑minimax。

## A "NEAT" Approach

在這個project的最後一週，